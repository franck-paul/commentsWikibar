"use strict";var dotclear=dotclear||{};dotclear.resizeTimer=void 0,dotclear.prevWidth=0,dotclear.jsLangSelect=class{constructor(e,t,s,i){this.confirm=e||"Ok",this.cancel=t||"Cancel",this.current=s||"",this.select=i}prompt(){return new Promise((e=>{const t=document.createElement("template");t.innerHTML=`<dialog class="jstDialog"><form method="dialog"><p class="fieldset">${this.select}</p><p class="form-buttons"><button name="cancel" class="reset">${this.cancel}</button><button type="submit" name="confirm" class="submit">${this.confirm}</button></p></form></dialog>`;const s=t.content.firstChild,i=s.querySelector("select");""!==this.current&&(i.value=this.current),document.body.appendChild(s),i.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),s.returnValue=i.value,s.close())}));const n=s.querySelector('button[name="confirm"]');n.addEventListener("click",(e=>{e.preventDefault(),s.returnValue=i.value,s.close()}));const o=s.querySelector('button[name="cancel"]');o.addEventListener("click",(()=>{s.dispatchEvent(new Event("cancel"))})),s.addEventListener("cancel",(function t(){s.removeEventListener("close",t),s.returnValue=null,document.body.removeChild(s),e(null)})),s.addEventListener("close",(function t(){s.removeEventListener("close",t);const i=s.returnValue;document.body.removeChild(s),e(i)})),s.showModal(),i.focus()}))}},dotclear.jsButton=class{constructor(e,t,s,i){this.title=e||null,this.fn=t||(()=>{}),this.scope=s||null,this.className=i||null,this.toolbarNode=null}draw(){if(!this.scope)return null;const e=document.createElement("button");e.setAttribute("type","button"),this.className&&(e.className=this.className);const t=document.createElement("span");t.className="sr-only",t.appendChild(document.createTextNode(this.title)),e.appendChild(t);const s=document.createElement("span");return s.className="jstb_icon",s.addEventListener("mouseover",this.mouseOverChild),s.addEventListener("mouseLeave",this.mouseLeaveChild),e.appendChild(s),e.addEventListener("keydown",this.keyDown),e.addEventListener("focus",this.focus),e.addEventListener("blur",this.blur),e.addEventListener("mouseover",this.mouseOver),e.addEventListener("mouseleave",this.mouseLeave),"function"==typeof this.fn&&e.addEventListener("click",(e=>{try{this.fn.apply(this.scope,e)}catch(e){}return!1})),e}keyDown(e){let t=!1;switch(e.keyCode){case 13:case 32:default:break;case 39:case 40:this.toolbarNode.moveFocus(this,"next"),t=!0;break;case 37:case 38:this.toolbarNode.moveFocus(this,"previous"),t=!0;break;case 36:this.toolbarNode.firstItem.focus(),t=!0;break;case 35:this.toolbarNode.lastItem.focus(),t=!0}t&&(e.stopPropagation(),e.preventDefault())}blur(e){e.target.firstChild.classList.add("sr-only"),document.querySelector(".jstElements").classList.remove("focus")}focus(e){this.toolbarNode.hideAllTooltips(),e.target.firstChild.classList.remove("sr-only"),document.querySelector(".jstElements").classList.add("focus")}mouseLeave(e){"BUTTON"===e.target.nodeName&&(e.target.classList.remove("hovered"),setTimeout((()=>{e.target.classList.contains("hovered")||e.target.firstChild.classList.add("sr-only")}),800))}mouseLeaveChild(e){if("SPAN"===e.target.nodeName&&e.target.classList.contains("jstb_icon")){const t=e.target.parentNode;t.classList.remove("hovered"),setTimeout((()=>{t.classList.contains("hovered")||t.firstChild.classList.add("sr-only")}),800)}}mouseOver(e){"BUTTON"===e.target.nodeName&&(this.toolbarNode.hideAllTooltips(),e.target.firstChild.classList.remove("sr-only"),e.target.classList.add("hovered"))}mouseOverChild(e){if("SPAN"===e.target.nodeName&&e.target.classList.contains("jstb_icon")){const t=e.target.parentNode;this.parentNode.toolbarNode.hideAllTooltips(),t.firstChild.classList.remove("sr-only"),t.classList.add("hovered")}}},dotclear.jsSpace=class{constructor(e){this.id=e||null,this.width=null}draw(){const e=document.createElement("span");return this.id&&(e.id=this.id),e.appendChild(document.createTextNode(String.fromCharCode(160))),e.setAttribute("aria-hidden","true"),e.className="jstSpacer",this.width&&(e.style.marginRight=`${this.width}px`),e}},dotclear.jsCombo=class{constructor(e,t,s,i,n){this.title=e||null,this.options=t||null,this.scope=s||null,this.fn=i||(()=>{}),this.className=n||null}draw(){if(!this.scope||!this.options)return null;const e=document.createElement("select");this.className&&(e.className=this.className),e.title=this.title;for(const t in this.options){const s=document.createElement("option");s.value=t,s.appendChild(document.createTextNode(this.options[t])),e.appendChild(s)}const t=this;return e.onchange=function(){try{t.fn.call(t.scope,this.value)}catch(e){window.alert(e)}return!1},e}},dotclear.jsToolBar=class{constructor(e,t="",s="wiki",i="",n=null,o={}){document.createElement&&e&&(void 0===document.selection&&void 0===e.setSelectionRange||(this.textarea=e,this.base_url=t,this.mode=s,this.label=i,this.language_select=o,this.editor=document.createElement("div"),this.editor.className="jstEditor",this.textarea.parentNode.insertBefore(this.editor,this.textarea),this.editor.appendChild(this.textarea),this.toolbar=document.createElement("div"),this.toolbar.className="jstElements",this.toolbar.setAttribute("role","toolbar"),this.toolbar.setAttribute("aria-label",this.label),this.toolbar.setAttribute("aria-controls","c_content"),this.editor.parentNode.insertBefore(this.toolbar,this.editor),this.context=null,this.toolNodes={},this.elements={strong:{type:"button",title:"Strong emphasis",fn:{wiki(){this.singleTag("__")},markdown(){this.singleTag("**")}}},em:{type:"button",title:"Emphasis",fn:{wiki(){this.singleTag("''")},markdown(){this.singleTag("*")}}},ins:{type:"button",title:"Inserted",fn:{wiki(){this.singleTag("++")},markdown(){this.singleTag("<ins>","</ins>")}}},del:{type:"button",title:"Deleted",fn:{wiki(){this.singleTag("--")},markdown(){this.singleTag("<del>","</del>")}}},quote:{type:"button",title:"Inline quote",fn:{wiki(){this.singleTag("{{","}}")},markdown(){this.singleTag("<q>","</q>")}}},code:{type:"button",title:"Code",fn:{wiki(){this.singleTag("@@")},markdown(){this.singleTag("`")}}},foreign:{type:"button",title:"Foreign text",fn:{async wiki(){await this.elements.foreign.prompt.call(this,"",(e=>{const t=`|${e}££`;this.encloseSelection("££",t)}))},async markdown(){await this.elements.foreign.prompt.call(this,"",(e=>{const t=`<i lang="${e}">`;this.encloseSelection(t,"</i>")}))}},lang_prompt:"Language of this text:",default_lang:"",async prompt(e="",t=null){const s=new dotclear.jsLangSelect(this.language_select.ok,this.language_select.cancel,e||this.elements.foreign.default_lang,this.language_select.select);await s.prompt().then((e=>{e&&t&&t(e)}))}},br:{type:"button",title:"Line break",fn:{wiki(){this.encloseSelection("%%%\n","")},markdown(){this.encloseSelection("  \n","")}}},ul:{type:"button",title:"Unordered list",fn:{wiki(){this.encloseSelection("","",(e=>`* ${e.replace(/\r/g,"").replace(/\n/g,"\n* ")}`))},markdown(){this.encloseSelection("","",(e=>`* ${e.replace(/\r/g,"").replace(/\n/g,"\n* ")}`))}}},ol:{type:"button",title:"Ordered list",fn:{wiki(){this.encloseSelection("","",(e=>`# ${e.replace(/\r/g,"").replace(/\n/g,"\n# ")}`))},markdown(){this.encloseSelection("","",(e=>`1. ${e.replace(/\r/g,"").replace(/\n/g,"\n1. ")}`))}}},pre:{type:"button",title:"Preformatted",fn:{wiki(){this.encloseSelection("","",(e=>` ${e.replace(/\r/g,"").replace(/\n/g,"\n ")}`))},markdown(){this.encloseSelection("\n","",(e=>`    ${e.replace(/\r/g,"").replace(/\n/g,"\n    ")}`))}}},bquote:{type:"button",title:"Block quote",fn:{wiki(){this.encloseSelection("","",(e=>`> ${e.replace(/\r/g,"").replace(/\n/g,"\n> ")}`))},markdown(){this.encloseSelection("\n","",(e=>`> ${e.replace(/\r/g,"").replace(/\n/g,"\n> ")}`))}}},link:{type:"button",title:"Link",fn:{async wiki(){await this.elements.link.prompt.call(this,"","","",(e=>{if(!e)return;let t=`|${e.href}`;e.hreflang&&(t=`${t}|${e.hreflang}`),e.title&&(e.hreflang||(t=`${t}|`),t=`${t}|${e.title}`),t=`${t}]`,this.encloseSelection("[",t)}))},async markdown(){await this.elements.link.prompt.call(this,"","","",(e=>{if(!e)return;let t=`](${e.href}`;e.title&&(t=`${t} "${e.title}"`),t=`${t})`,e.hreflang&&(t=`${t}{hreflang=${e.hreflang}}`),this.encloseSelection("[",t)}))}},href_prompt:"Please give page URL:",hreflang_prompt:"Language of this page:",title_prompt:"Title:",default_hreflang:"",default_title:"",async prompt(e="",t="",s="",i=null){const n=t||this.elements.link.default_hreflang;let o=s||this.elements.link.default_title;const l=window.prompt(this.elements.link.href_prompt,e);if(!l)return null;o=window.prompt(this.elements.link.title_prompt,o);const a=new dotclear.jsLangSelect(this.language_select.ok,this.language_select.cancel,n,this.language_select.select);await a.prompt().then((e=>{null!==e&&i&&i({href:this.stripBaseURL(l),hreflang:e,title:o})}))}}},n&&dotclear.mergeDeep(this.elements,n),window.addEventListener("resize",(()=>{void 0!==dotclear.resizeTimer&&clearTimeout(dotclear.resizeTimer),dotclear.resizeTimer=setTimeout((()=>{document.documentElement.clientWidth!==dotclear.prevWidth&&(this.updateTooltipsPos(),dotclear.prevWidth=document.documentElement.clientWidth)}),250)}))))}getMode(){return this.mode}setMode(e){this.mode=e||"wiki"}switchMode(e="wiki"){this.draw(e)}button(e){const t=this.elements[e];if("function"!=typeof t.fn[this.mode])return null;const s=new dotclear.jsButton(t.title,t.fn[this.mode],this,`jstb_${e}`);return s}space(e){const t=new dotclear.jsSpace(e);return void 0!==this.elements[e].width&&(t.width=this.elements[e].width),t}combo(e){const t=this.elements[e],s=t[this.mode].list.length;if("function"!=typeof t[this.mode].fn||0===s)return null;const i={};for(const e of t[this.mode].list)i[e]=t.options[e];return new dotclear.jsCombo(t.title,i,this,t[this.mode].fn)}draw(e){for(this.setMode(e);this.toolbar.hasChildNodes();)this.toolbar.removeChild(this.toolbar.firstChild);this.toolNodes={};for(const e in this.elements){const t=this.elements[e],s=void 0===t.type||""===t.type||void 0!==t.disabled&&t.disabled||void 0!==t.context&&null!=t.context&&t.context!==this.context;if(!s&&"function"==typeof this[t.type]){const s=this[t.type](e);if(s){const t=s.draw();t&&(this.toolNodes[e]=t,this.toolbar.appendChild(t),t.toolbarNode=this)}}}this.firstItem=document.querySelector(".jstElements button:first-child"),this.lastItem=document.querySelector(".jstElements button:last-child"),this.items=Array.from(document.querySelectorAll(".jstElements button")),this.updateTooltipsPos(),document.body.addEventListener("keydown",this.keyDown.bind(this))}keyDown(e){27===e.keyCode&&this.hideAllTooltips()}singleTag(e=null,t=e){e&&t&&this.encloseSelection(e,t)}encloseSelection(e="",t="",s=null){let i,n,o,l,a,r;this.textarea.focus(),void 0!==document.selection?o=document.selection.createRange().text:void 0!==this.textarea.setSelectionRange&&(i=this.textarea.selectionStart,n=this.textarea.selectionEnd,l=this.textarea.scrollTop,o=this.textarea.value.substring(i,n));let c=t;o.match(/ $/)&&(o=o.substring(0,o.length-1),c+=" "),r="function"==typeof s?o?s.call(this,o):s(""):o||"",a=e+r+c,void 0!==document.selection?(document.selection.createRange().text=a,this.textarea.caretPos-=t.length):void 0!==this.textarea.setSelectionRange&&(this.textarea.value=this.textarea.value.substring(0,i)+a+this.textarea.value.substring(n),r.length?this.textarea.setSelectionRange(i+a.length,i+a.length):this.textarea.setSelectionRange(i+e.length,i+e.length),this.textarea.scrollTop=l)}stripBaseURL(e){return""!==this.base_url&&0===e.indexOf(this.base_url)?e.substring(this.base_url.length):e}moveFocus(e,t){let s;s="previous"===t?e===this.firstItem?this.lastItem:this.items[this.items.indexOf(e)-1]:e===this.lastItem?this.firstItem:this.items[this.items.indexOf(e)+1],s.focus()}updateTooltipsPos(){for(const e of document.querySelectorAll(".jstElements button span")){if(e.classList.contains("jstb_icon"))continue;const t=e.parentNode.getBoundingClientRect().left;e.style.left="0px",e.classList.add("hidden"),e.classList.remove("sr-only");const s=e.clientWidth;if(e.classList.add("sr-only"),e.classList.remove("hidden"),s+t>document.documentElement.clientWidth-15){const i=Math.trunc(-1*(s+t-document.documentElement.clientWidth+15));e.style.left=`${i}px`}}}hideAllTooltips(){for(const e of document.querySelectorAll(".jstElements button span"))e.classList.contains("jstb_icon")||e.classList.add("sr-only")}};
