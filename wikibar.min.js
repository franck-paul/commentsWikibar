"use strict";var dotclear=dotclear||{};Object.assign(dotclear,{jsToolBar:function(t){document.createElement&&t&&(void 0===document.selection&&void 0===t.setSelectionRange||(this.textarea=t,this.editor=document.createElement("div"),this.editor.className="jstEditor",this.textarea.parentNode.insertBefore(this.editor,this.textarea),this.editor.appendChild(this.textarea),this.toolbar=document.createElement("div"),this.toolbar.className="jstElements",this.toolbar.setAttribute("role","toolbar"),this.toolbar.setAttribute("aria-label",this.label),this.toolbar.setAttribute("aria-controls","c_content"),this.editor.parentNode.insertBefore(this.toolbar,this.editor),this.context=null,this.toolNodes={}))},jsButton:function(t,e,o,n){this.title=t||null,this.fn=e||function(){},this.scope=o||null,this.className=n||null,this.toolbarNode=null},jsSpace:function(t){this.id=t||null,this.width=null},jsCombo:function(t,e,o,n,s){this.title=t||null,this.options=e||null,this.scope=o||null,this.fn=n||function(){},this.className=s||null},resizeTimer:void 0,prevWidth:0}),window.addEventListener("resize",(function(){void 0!==dotclear.resizeTimer&&clearTimeout(dotclear.resizeTimer),dotclear.resizeTimer=setTimeout((function(){document.documentElement.clientWidth!==dotclear.prevWidth&&(dotclear.jsToolBar.prototype.updateTooltipsPos(),dotclear.prevWidth=document.documentElement.clientWidth)}),250)})),dotclear.jsToolBar.prototype={base_url:"",mode:"wiki",elements:{},getMode:function(){return this.mode},setMode:function(t){this.mode=t||"wiki"},switchMode:function(t){t=t||"wiki",this.draw(t)},button:function(t){const e=this.elements[t];if("function"!=typeof e.fn[this.mode])return null;const o=new dotclear.jsButton(e.title,e.fn[this.mode],this,"jstb_"+t);return null!=e.icon&&(o.icon=e.icon),o},space:function(t){const e=new dotclear.jsSpace(t);return void 0!==this.elements[t].width&&(e.width=this.elements[t].width),e},combo:function(t){const e=this.elements[t],o=e[this.mode].list.length;if("function"!=typeof e[this.mode].fn||0==o)return null;{let t={};for(let n=0;n<o;n++){const o=e[this.mode].list[n];t[o]=e.options[o]}return new dotclear.jsCombo(e.title,t,this,e[this.mode].fn)}},draw:function(t){for(this.setMode(t);this.toolbar.hasChildNodes();)this.toolbar.removeChild(this.toolbar.firstChild);this.toolNodes={};for(let t in this.elements){const e=this.elements[t];if(!(null==e.type||""==e.type||null!=e.disabled&&e.disabled||null!=e.context&&null!=e.context&&e.context!=this.context)&&"function"==typeof this[e.type]){const o=this[e.type](t);if(o){const e=o.draw();e&&(this.toolNodes[t]=e,this.toolbar.appendChild(e),e.toolbarNode=this)}}}this.firstItem=document.querySelector(".jstElements button:first-child"),this.lastItem=document.querySelector(".jstElements button:last-child"),this.items=Array.from(document.querySelectorAll(".jstElements button")),this.initTabindex(),this.updateTooltipsPos(),document.body.addEventListener("keydown",this.keyDown.bind(this))},keyDown:function(t){27==t.keyCode&&(this.hideAllTooltips(),t.stopPropagation(),t.preventDefault())},singleTag:function(t,e){t=t||null,e=e||t,t&&e&&this.encloseSelection(t,e)},encloseSelection:function(t,e,o){let n,s,i,l,r,a;this.textarea.focus(),t=t||"",e=e||"",void 0!==document.selection?i=document.selection.createRange().text:void 0!==this.textarea.setSelectionRange&&(n=this.textarea.selectionStart,s=this.textarea.selectionEnd,l=this.textarea.scrollTop,i=this.textarea.value.substring(n,s)),i.match(/ $/)&&(i=i.substring(0,i.length-1),e+=" "),a="function"==typeof o?i?o.call(this,i):o(""):i||"",r=t+a+e,void 0!==document.selection?(document.selection.createRange().text=r,this.textarea.caretPos-=e.length):void 0!==this.textarea.setSelectionRange&&(this.textarea.value=this.textarea.value.substring(0,n)+r+this.textarea.value.substring(s),i?this.textarea.setSelectionRange(n+r.length,n+r.length):this.textarea.setSelectionRange(n+t.length,n+t.length),this.textarea.scrollTop=l)},stripBaseURL:function(t){return""!=this.base_url&&0==t.indexOf(this.base_url)&&(t=t.substr(this.base_url.length)),t}},dotclear.jsToolBar.prototype.initTabindex=function(){for(let t=1;t<this.items.length;t++)this.items[t].setAttribute("tabindex","-1");this.items[0].setAttribute("tabindex","0")},dotclear.jsToolBar.prototype.setFocus=function(t){for(let t=0;t<this.items.length;t++)this.items[t].setAttribute("tabindex","-1");t.setAttribute("tabindex","0"),t.focus()},dotclear.jsToolBar.prototype.moveFocus=function(t,e){let o;o="previous"==e?t===this.firstItem?this.lastItem:this.items[this.items.indexOf(t)-1]:t===this.lastItem?this.firstItem:this.items[this.items.indexOf(t)+1],this.setFocus(o)},dotclear.jsToolBar.prototype.updateTooltipsPos=function(){Array.from(document.querySelectorAll(".jstElements button span")).forEach((function(t){const e=t.parentNode.getBoundingClientRect().left;t.style.left="0px",t.classList.add("hidden"),t.classList.remove("sr-only");const o=t.clientWidth;if(t.classList.add("sr-only"),t.classList.remove("hidden"),o+e>document.documentElement.clientWidth-15){const n=Math.trunc(-1*(o+e-document.documentElement.clientWidth+15));t.style.left=n+"px"}}))},dotclear.jsToolBar.prototype.hideAllTooltips=function(){Array.from(document.querySelectorAll(".jstElements button span")).forEach(t=>{t.classList.add("sr-only")})},dotclear.jsButton.prototype.draw=function(){if(!this.scope)return null;const t=document.createElement("button");t.setAttribute("type","button"),this.className&&(t.className=this.className);const e=document.createElement("span");return e.className="sr-only",e.appendChild(document.createTextNode(this.title)),t.appendChild(e),null!=this.icon&&(t.style.backgroundImage='url(" + this.icon + ")'),t.addEventListener("keydown",dotclear.jsButton.prototype.keyDown),t.addEventListener("focus",dotclear.jsButton.prototype.focus),t.addEventListener("blur",dotclear.jsButton.prototype.blur),t.addEventListener("mouseover",dotclear.jsButton.prototype.mouseOver),t.addEventListener("mouseleave",dotclear.jsButton.prototype.mouseLeave),"function"==typeof this.fn&&(t.onclick=()=>{try{this.fn.apply(this.scope,arguments)}catch(t){}return!1}),t},dotclear.jsButton.prototype.keyDown=function(t){let e=!1;switch(t.keyCode){case 13:case 32:break;case 39:this.toolbarNode.moveFocus(this,"next"),e=!0;break;case 37:this.toolbarNode.moveFocus(this,"previous"),e=!0;break;case 36:this.toolbarNode.setFocus(this.toolbarNode.firstItem),e=!0;break;case 35:this.toolbarNode.setFocus(this.toolbarNode.lastItem),e=!0;break;case 38:this.toolbarNode.moveFocus(this,"previous"),e=!0;break;case 40:this.toolbarNode.moveFocus(this,"next"),e=!0}e&&(t.stopPropagation(),t.preventDefault())},dotclear.jsButton.prototype.blur=function(t){t.target.firstChild.classList.add("sr-only"),document.querySelector(".jstElements").classList.remove("focus")},dotclear.jsButton.prototype.focus=function(t){this.toolbarNode.hideAllTooltips(),t.target.firstChild.classList.remove("sr-only"),document.querySelector(".jstElements").classList.add("focus")},dotclear.jsButton.prototype.mouseLeave=function(t){"BUTTON"===t.target.nodeName&&(t.target.classList.remove("hovered"),setTimeout((function(){t.target.classList.contains("hovered")||t.target.firstChild.classList.add("sr-only")}),800))},dotclear.jsButton.prototype.mouseOver=function(t){"BUTTON"===t.target.nodeName&&(this.toolbarNode.hideAllTooltips(),t.target.firstChild.classList.remove("sr-only"),t.target.classList.add("hovered"))},dotclear.jsSpace.prototype.draw=function(){const t=document.createElement("span");return this.id&&(t.id=this.id),t.appendChild(document.createTextNode(String.fromCharCode(160))),t.setAttribute("aria-hidden","true"),t.className="jstSpacer",this.width&&(t.style.marginRight=this.width+"px"),t},dotclear.jsCombo.prototype.draw=function(){if(!this.scope||!this.options)return null;const t=document.createElement("select");this.className&&(t.className=this.className),t.title=this.title;for(let e in this.options){const o=document.createElement("option");o.value=e,o.appendChild(document.createTextNode(this.options[e])),t.appendChild(o)}let e=this;return t.onchange=function(){try{e.fn.call(e.scope,this.value)}catch(t){window.alert(t)}return!1},t},dotclear.jsToolBar.prototype.elements.strong={type:"button",title:"Strong emphasis",fn:{wiki:function(){this.singleTag("__")},markdown:function(){this.singleTag("**")}}},dotclear.jsToolBar.prototype.elements.em={type:"button",title:"Emphasis",fn:{wiki:function(){this.singleTag("''")},markdown:function(){this.singleTag("*")}}},dotclear.jsToolBar.prototype.elements.ins={type:"button",title:"Inserted",fn:{wiki:function(){this.singleTag("++")},markdown:function(){this.singleTag("<ins>","</ins>")}}},dotclear.jsToolBar.prototype.elements.del={type:"button",title:"Deleted",fn:{wiki:function(){this.singleTag("--")},markdown:function(){this.singleTag("<del>","</del>")}}},dotclear.jsToolBar.prototype.elements.quote={type:"button",title:"Inline quote",fn:{wiki:function(){this.singleTag("{{","}}")},markdown:function(){this.singleTag("<q>","</q>")}}},dotclear.jsToolBar.prototype.elements.code={type:"button",title:"Code",fn:{wiki:function(){this.singleTag("@@")},markdown:function(){this.singleTag("`")}}},dotclear.jsToolBar.prototype.elements.space1={type:"space"},dotclear.jsToolBar.prototype.elements.br={type:"button",title:"Line break",fn:{wiki:function(){this.encloseSelection("%%%\n","")},markdown:function(){this.encloseSelection("  \n","")}}},dotclear.jsToolBar.prototype.elements.space2={type:"space"},dotclear.jsToolBar.prototype.elements.ul={type:"button",title:"Unordered list",fn:{wiki:function(){this.encloseSelection("","",t=>"* "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n* "))},markdown:function(){this.encloseSelection("","",t=>"* "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n* "))}}},dotclear.jsToolBar.prototype.elements.ol={type:"button",title:"Ordered list",fn:{wiki:function(){this.encloseSelection("","",t=>"# "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n# "))},markdown:function(){this.encloseSelection("","",t=>"1. "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n1. "))}}},dotclear.jsToolBar.prototype.elements.pre={type:"button",title:"Preformatted",fn:{wiki:function(){this.encloseSelection("","",t=>" "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n "))},markdown:function(){this.encloseSelection("\n","",t=>"    "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n    "))}}},dotclear.jsToolBar.prototype.elements.bquote={type:"button",title:"Block quote",fn:{wiki:function(){this.encloseSelection("","",t=>"> "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n> "))},markdown:function(){this.encloseSelection("\n","",t=>"> "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n> "))}}},dotclear.jsToolBar.prototype.elements.space3={type:"space"},dotclear.jsToolBar.prototype.elements.link={type:"button",title:"Link",fn:{},href_prompt:"Please give page URL:",hreflang_prompt:"Language of this page:",title_prompt:"Title:",default_hreflang:"",default_title:"",prompt:function(t,e,o){return t=t||"",e=e||this.elements.link.default_hreflang,o=o||this.elements.link.default_title,!!(t=window.prompt(this.elements.link.href_prompt,t))&&("markdown"!==this.mode?e=window.prompt(this.elements.link.hreflang_prompt,e):o=window.prompt(this.elements.link.title_prompt,o),{href:this.stripBaseURL(t),hreflang:e,title:o})}},dotclear.jsToolBar.prototype.elements.link.fn.wiki=function(){const t=this.elements.link.prompt.call(this);if(t){let e="[",o="|"+t.href;t.hreflang&&(o=o+"|"+t.hreflang),o+="]",this.encloseSelection(e,o)}},dotclear.jsToolBar.prototype.elements.link.fn.markdown=function(){const t=this.elements.link.prompt.call(this);if(t){let e="[",o="]("+t.href;t.title&&(o=o+' "'+t.title+'"'),o+=")",this.encloseSelection(e,o)}};
